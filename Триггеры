-- Триггеры
-- Триггер для Lost Update
CREATE TRIGGER trg_prevent_lost_update
	BEFORE UPDATE ON bank_accounts
	FOR EACH ROW
	EXECUTE FUNCTION prevent_lost_update();

-- Триггер для Non-repeatable Read и Phantom Read и Anomaly / Write Skew
CREATE or REPLACE TRIGGER trg_bank_accounts_at_least_one_active
    BEFORE INSERT OR UPDATE OR DELETE ON bank_accounts
    FOR EACH ROW
    EXECUTE FUNCTION accounts_guarded_write();

-- Триггер для проверки бизнес логики
CREATE TRIGGER trg_accounts_write_lock
BEFORE UPDATE OR DELETE
ON bank_accounts
FOR EACH ROW
EXECUTE FUNCTION accounts_business_rule_check();
